source /$(pwd)/functions

heading_start "Hardware"

sub_start "Version"
lsb_release -d >>$ofile
sub_end

sub_start "Kernel"
uname -r >>$ofile
sub_end

sub_start "CPU"
cat /proc/cpuinfo >>$ofile
sub_end

sub_start "Motherboard/BIOS Details"
[ -f /usr/sbin/dmidecode ] && sudo -v && echo -n "Motherboard" >> $ofile && sudo /usr/sbin/dmidecode -t 1 | grep "Manufacturer\|Product Name\|Serial Number" | tr -d "\t" | sed "s/Manufacturer//" >> $ofile && echo -ne "\nBIOS" >> $ofile && sudo /usr/sbin/dmidecode -t 0 | grep "Vendor\|Version\|Release" | tr -d "\t" | sed "s/Vendor//" >> $ofile
sub_end

sub_start "Ethernet"
lspci | grep Ethernet >>$ofile
sub_end

sub_start "Interface"
ifconfig | grep eth | cut -c1-4 >interfaces.tmp
while read line
do
ethtool $line >>$ofile
done <interfaces.tmp
rm -f interfaces.tmp
sub_end

sub_start "File System"
df -h >>$ofile
sub_end

sub_start "FStab"
cat /etc/fstab >>$ofile
sub_end

sub_start "Interrupts"
cat /proc/interrupts >>$ofile
sub_end

sub_start "Hardware List"
lshw -short >>$ofile
sub_end

sub_start "Boot Errors"
dmesg -n1 >>$ofile
dmesg | grep -i error >>$ofile
sub_end

heading_end

heading_start "Network Config"

sub_start "Firewall"
grep -v "^#" /etc/firewall | grep -v "^$" >>$ofile
sub_end

sub_start "Interface Settings"
ifconfig >>$ofile
sub_end

sub_start "Wireless Settings"
iwconfig >>$ofile 2>>$errfile
sub_end

sub_start "DNS Servers"
cat /etc/resolv.conf | grep -i nameserver >>$ofile
sub_end

sub_start "Firewall rules"
iptables -L -v -n >>$ofile
sub_end

sub_start "Route"
route -n >>$ofile
sub_end

sub_start "Hosts"
cat /etc/hosts >>$ofile
sub_end

heading_end

heading_start "Server Status"

sub_start "Processor/RAM Usage"
top -b -n 1 | sed -n '1,20p' >>$ofile
sub_end

sub_start "Running Processes"
ps -eHf >>$ofile
sub_end

sub_start "Running Services"
service --status-all 2>>$errfile | grep -e 'running\|cours' | grep -v 'not running' >>$ofile
sub_end

sub_start "TCP Connections"
netstat -vnpta >>$ofile
sub_end

sub_start "TCP Statistics"
netstat -st | head -n 27 >>$ofile
sub_end

heading_end
